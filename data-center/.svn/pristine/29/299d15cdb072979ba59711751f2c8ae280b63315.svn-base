/*! taomee tongji javascript code by maverick 2015-02-04 */
!function(a){a.widget("stat.table",{scrollSize:17,wrapper:null,rowed:!1,columned:!1,cornered:!1,defaultClass:{tableWrapper:"fixed-table-wrapper",cornerCon:"fixed-corner",rowCon:"fixed-row",columnCon:"fixed-column",tableCon:"fixed-body",stripedTable:"striped-table",table:"fixed-table",tbody:"fixed-tbody",tr:"tr",th:"th",strip:"strip"},options:{striped:!1,wrapWidth:800,wrapHeight:400,rowNum:1,colNum:1,highlight:!0},_create:function(){var b=this.options;this.element.addClass(this.defaultClass.table),this._fixedTable(),b.highlight&&this._highlight(),a.browser.msie&&this._strip()},tableWidth:0,realTableWrap:null,wrapHeight:0,_fixedTable:function(){var b=this.options,c=(this.element.parent(),this.element.outerWidth()),d=this.element.outerHeight(),e=this._getWrapper(),f=a(document.createElement("div")).addClass(this.defaultClass.tableCon).css({overflow:"auto",width:b.wrapWidth,height:b.wrapHeight}).append(this.element.addClass(this.defaultClass.table+(b.striped?" "+this.defaultClass.stripedTable:""))).appendTo(e);this.tableWidth=c,this.wrapHeight=b.wrapHeight,this.realTableWrap=f,c>b.wrapWidth&&d>this.wrapHeight?(this._fixedCorner(),this._fixedRow(),this.columned=!0,this._fixedColumn()):c>b.wrapWidth&&d<=this.wrapHeight?(this.wrapHeight=d+this.scrollSize,f.height(this.wrapHeight),this.columned=!0,this._fixedColumn()):c<=b.wrapWidth&&d>this.wrapHeight?(this.element.width(b.wrapWidth-this.scrollSize),this._fixedRow()):(this.wrapHeight=d,f.height(this.wrapHeight),this.element.width(b.wrapWidth))},rejustWrapWidth:function(){if(!this.realTableWrap.is(":hidden")){var a=this.realTableWrap.parent().get(0).clientWidth,b=this.options.wrapWidth;this._setOption("wrapWidth",a),a>b?(this.element.width(this.options.wrapWidth-this.scrollSize),this.realTableWrap.width(a)):this.columned?this.realTableWrap.width(a):this.tableWidth>a&&this._fixedColumn(),this.rowed&&this._getCon(this.defaultClass.rowCon,1).width(a-this.scrollSize)}},rejustWrapHeight:function(){if(!this.realTableWrap.is(":hidden")){var a=this._maxHeight();if(this.columned){var b=this;this.columnCon.height(a-this.scrollSize+2),window.setTimeout(function(){b._addColumn()},100)}else this.element.outerWidth()>this.options.wrapWidth&&(this.columned=!0,this._fixedColumn());!this.rowed&&this.element.outerHeight()>this.options.wrapHeight&&(this.element.width(this.element.width()-17),this._fixedRow()),!this.cornered&&this.rowed&&this.columned&&this._fixedCorner(),this.realTableWrap.height(a),this.element.parent().height(a)}},_maxHeight:function(){var a=this.element.height()+this.scrollSize,b=this.options.wrapHeight;return a>b?b:a},_fixedCorner:function(){for(var b=this._getCon(this.defaultClass.cornerCon,2).empty(),c=a(document.createElement("table")).addClass(this.defaultClass.table+" "+this.element.attr("class")),d=a(document.createElement("thead")),e=a(document.createElement("tbody")),f=this.element.find("thead tr th"),g=this.element.find("tbody tr"),h=0,i=0,j=a(document.createElement("tr")),k=0;k<this.options.colNum;k++)a(f[k]).clone().appendTo(j),h+=a(f[k]).outerWidth();i+=a(f[k]).outerHeight(),j.appendTo(d);for(var k=0;k<this.options.rowNum-1;k++){for(var l=a(document.createElement("tr")),m=a(g[k]).find("td"),n=0;n<this.options.colNum;n++)a(m[n]).clone().appendTo(l),this.options.striped&&k%2==1&&l.addClass("odd");i+=a(m[n]).outerHeight(),l.appendTo(e)}c.css({width:h+1+"px",height:i+"px"}),b.css({width:h+1+"px",height:i+1+"px",overflow:"hidden"}),c.append(d.add(e)).appendTo(b),this.cornered=!0},_fixedRow:function(){for(var b=this.element.find("thead"),c=this.element.find("tbody"),d=this._getCon(this.defaultClass.rowCon,1).empty(),e=a(document.createElement("table")).addClass(this.defaultClass.table+" "+this.element.attr("class")),f=b.clone(),g=a(document.createElement("tbody")),h=c.find("tr"),i=b.outerHeight(),j=c.find("tr:eq(0)").outerHeight(),k=a(),l=0;l<this.options.rowNum-1;l++){var m=a(h[l]).clone();this.options.striped&&l%2==1&&m.addClass("odd"),k=k.add(m),i+=j}g.append(k),e.css({width:this.element.outerWidth()+1+"px",height:i+"px "}),d.css({width:this.options.wrapWidth+1-this.scrollSize+"px",height:i+1+"px",overflow:"hidden"}),e.append(f.add(g)).appendTo(d),this.wrapper.find("."+this.defaultClass.tableCon).scroll(function(){e.css({"margin-left":"-"+a(this).scrollLeft()+"px"})}),this.rowed=!0},_fixedColumn:function(){this.columning=!0;var b=this._getCon(this.defaultClass.columnCon,1).empty(),c=a(document.createElement("table")).addClass(this.defaultClass.table+" "+this.element.attr("class")),d=a(document.createElement("thead")),e=a(document.createElement("tbody")),f=0,g=0;this.columnCon=b;for(var h=a(document.createElement("tr")).addClass(this.defaultClass.tr),i=this.element.find("thead tr th"),j=a(),k=0;k<this.options.colNum;k++)f+=a(i[k]).outerWidth(),j=j.add(a(i[k]).clone());g+=a(i[k]).outerHeight(),h.append(j).appendTo(d);for(var l=this.element.find("tbody tr"),m=a(),k=0;k<l.length;k++){var n=a(document.createElement("tr")),o=a(l[k]).find("td"),p=a();a(l[k]).addClass("columned");for(var q=0;q<this.options.colNum;q++)p=p.add(a(o[q]).clone());p.appendTo(n),g+=a(o[q]).outerHeight(),this.options.striped&&k%2==1&&n.addClass("odd"),m=m.add(n.append(p))}e.append(m),c.css({width:f+1+"px",height:g+1+"px"}),b.css({width:f+1+"px",height:(this.columned?this.wrapHeight-this.scrollSize:this.wrapHeight)+"px",overflow:"hidden"}),c.append(d).append(e).appendTo(b),this.wrapper.find("."+this.defaultClass.tableCon).scroll(function(){c.css({"margin-top":"-"+a(this).scrollTop()+"px"})}),this.columning=!1},columning:!0,_addColumn:function(){if(!this.columning){this.columning=!0;for(var b=this.columnCon.find("table"),c=b.find("tbody"),d=this.element.find("tbody"),e=b.outerHeight(),f=d.find("tr").not(".columned"),g=a(),h=0;h<f.length;h++){for(var i=a(document.createElement("tr")),j=a(f[h]).find("td"),k=a(),l=0;l<this.options.colNum;l++)k=k.add(a(j[l]).clone());a(f[h]).addClass("columned"),k.appendTo(i),e+=a(j[l]).outerHeight(),this.options.striped&&h%2==1&&i.addClass("odd"),g=g.add(i.append(k))}c.append(g),b.css({height:e+1+"px"}),this.columning=!1}},_getCon:function(b,c){var d=this.wrapper?this.wrapper:this._getWrapper(),e=d.find("."+b);return e.length?e:a(document.createElement("div")).addClass(b).css({position:"absolute","z-index":c,top:0,left:0}).appendTo(d)},_getWrapper:function(){return this.wrapper=this.wrapper?this.wrapper:this.wrapper=a(document.createElement("div")).addClass(this.defaultClass.tableWrapper).css({position:"relative"}).appendTo(this.element.parent()),this.wrapper},_highlight:function(){var b=(this.options,this),c=a();b.columned&&(c=b.wrapper.find("."+b.defaultClass.columnCon+" ."+b.defaultClass.table+" tbody"),c.find("tr").each(function(c){var d=a(this);d.mouseover(function(){d.addClass("highlight"),b.element.find("tbody tr:eq("+c+")").addClass("highlight")}).mouseout(function(){d.removeClass("highlight"),b.element.find("tbody tr:eq("+c+")").removeClass("highlight")})})),b.element.find("tbody tr").each(function(d){var e=a(this);e.mouseover(function(){e.addClass("highlight"),b.columned&&c.find("tr:eq("+d+")").addClass("highlight")}).mouseout(function(){e.removeClass("highlight"),b.columned&&c.find("tr:eq("+d+")").removeClass("highlight")})})},_strip:function(){var a=this;if(a.element.find("tbody tr:even").addClass("strip"),a.columned){var b=a._getCon(a.defaultClass.columnCon);b.find("tbody tr:even").addClass("strip")}if(a.rowed){var c=a._getCon(a.defaultClass.rowCon);c.find("tbody tr:even").addClass("strip")}}})}(jQuery);