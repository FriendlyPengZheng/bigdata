/*! taomee tongji javascript code by maverick 2015-02-04 */
$(function(){$.Select={CONST:{CSS_CON:"select-con",CSS_TITLE:"select-title",CSS_OPTION_CON:"select-option-con",CSS_SELECT_ITEM:"select-item",CSS_SELECTED_ITEM:"selected-item"},LANGUAGE:{chinese:{defaultTitle:"请选择："},english:{defaultTitle:"select:"}},create:function(a){var b={data:[],language:"chinese",container:$("body")};return $.extend(b,a),$.Select.LANGUAGE[b.language]||(b.language="chinese"),b=$.extend({},$.Select.LANGUAGE[b.language],b),new _selectFactory(b)._getInstance()},_selectFactory:function(a){this.selectContainer=$(document.createElement("div")).addClass($.Select.CONST.CSS_CON),$.Select.setOptionContent($optionCon,a.data),a.container.append(this.selectContainer),$.Select.bindEvents(this.selectContainer,!1)},setOptionContent:function(a,b){var c=$(document.createElement("div")).addClass($.Select.CONST.CSS_TITLE),d=$(document.createElement("div")).addClass($.Select.CONST.CSS_OPTION_CON),e="<ul>";a.empty().append(c.add(d)),b&&b.length&&$.each(b,function(){e+='<li class="'+$.Select.CONST.CSS_SELECT_ITEM,this.selected&&(c.attr("data-id",this.id).text(this.name),e+=" "+$.Select.CONST.CSS_SELECTED_ITEM),e+='" data-id="'+this.id+'" >'+this.name+"</li>"}),e+="</ul>",d.html(e)},bindEvents:function(a,b,c){var d=a.find("."+$.Select.CONST.CSS_TITLE),e=a.find("."+$.Select.CONST.CSS_OPTION_CON);d.click(function(a){a.stopPropagation(),e.is(":visible")?e.hide():e.show()});var f=function(a,b,d,e){a.siblings().removeClass($.Select.CONST.CSS_SELECTED_ITEM),a.addClass($.Select.CONST.CSS_SELECTED_ITEM),b.attr("data-id",d).text(e),c&&c()};if(e.find("ul li").click(function(a){a.stopPropagation();var b=$(a.target),c=d.attr("data-id"),g=(d.text(),b.attr("data-id")),h=b.text();c!=g&&f(b,d,g,h),e.hide()}),b){var g=e.find("ul li").first();f(g,d,g.attr("data-id"),g.text())}a.attr("tabindex","0").bind("keydown",function(b){switch(b.keyCode){case 13:e.hide();break;case 38:b.preventDefault();var c=a.find("."+$.Select.CONST.CSS_SELECTED_ITEM),g=c.prev();g&&g.hasClass($.Select.CONST.CSS_SELECT_ITEM)&&f(g,d,g.attr("data-id"),g.text());break;case 40:b.preventDefault();var c=a.find("."+$.Select.CONST.CSS_SELECTED_ITEM),g=c.next();g&&g.hasClass($.Select.CONST.CSS_SELECT_ITEM)&&f(g,d,g.attr("data-id"),g.text())}}),$("body").click(function(){e.hide()})}},$.widget("can.tmselect",{selectContainer:null,CONST:{common:{CSS_CON:"select-con",CSS_TITLE:"select-title",CSS_OPTION_CON:"select-option-con",CSS_SELECT_ITEM:"select-item",CSS_SELECTED_ITEM:"selected-item"},white:{CSS_CON:"select-con-white",CSS_TITLE:"select-title-white",CSS_OPTION_CON:"select-option-con-white",CSS_SELECT_ITEM:"select-item-white",CSS_SELECTED_ITEM:"selected-item-white"}},options:{colorTheme:"common",href:!1},_create:function(){var a=this;this._selectFactory(),$("body").click(function(){a.selectContainer.find("."+a.CONST[a.options.colorTheme].CSS_OPTION_CON).hide()})},_selectFactory:function(){this.selectContainer=$(document.createElement("div")).addClass(this.CONST[this.options.colorTheme].CSS_CON);var a=this,b=$(document.createElement("div")).addClass(a.CONST[a.options.colorTheme].CSS_TITLE).text("请选择："),c=$(document.createElement("div")).addClass(a.CONST[a.options.colorTheme].CSS_OPTION_CON),d="<ul>";this.element.find("option").each(function(){var c=$(this),e=c.attr("data-id"),f=c.text();d+='<li class="'+a.CONST[a.options.colorTheme].CSS_SELECT_ITEM,c.attr("selected")&&(b.attr("data-id",e).text(f),d+=" "+a.CONST[a.options.colorTheme].CSS_SELECTED_ITEM),d+='" data-id="'+e+'" title="'+f+'" >'+(a.options.href?'<a href="'+c.attr("data-href")+'">'+f+"</a>":f)+"</li>"}),d+="</ul>",c.html(d),this.selectContainer.append(b.add(c)),a.element.hide().after(this.selectContainer),b.click(function(a){a.stopPropagation(),c.is(":visible")?c.hide():c.show()});var e=function(b,c,d,e){b.siblings().removeClass(a.CONST[a.options.colorTheme].CSS_SELECTED_ITEM),b.addClass(a.CONST[a.options.colorTheme].CSS_SELECTED_ITEM),c.attr("data-id",d).text(e),a.element.find("option:selected").attr("selected",!1),a.element.find('option[data-id="'+d+'"]').attr("selected",!0),a.element.change()};c.find("ul li").click(function(a){a.stopPropagation();var d=$(a.target),f=b.attr("data-id"),g=(b.text(),d.attr("data-id")),h=d.text();f!=g&&e(d,b,g,h),c.hide()}),a.selectContainer.attr("tabindex","0").bind("keydown",function(d){switch(d.keyCode){case 13:c.hide();break;case 38:d.preventDefault();var f=a.selectContainer.find("."+a.CONST[a.options.colorTheme].CSS_SELECTED_ITEM),g=f.prev();g&&g.hasClass(a.CONST[a.options.colorTheme].CSS_SELECT_ITEM)&&e(g,b,g.attr("data-id"),g.text());break;case 40:d.preventDefault();var f=a.selectContainer.find("."+a.CONST[a.options.colorTheme].CSS_SELECTED_ITEM),g=f.next();g&&g.hasClass(a.CONST[a.options.colorTheme].CSS_SELECT_ITEM)&&e(g,b,g.attr("data-id"),g.text())}})},getSelectContainer:function(){return this.selectContainer}})});