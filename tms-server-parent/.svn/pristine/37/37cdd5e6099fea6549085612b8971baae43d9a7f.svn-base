<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.taomee.tms.mgr.dao.ServerGPZSInfoDao">
	<resultMap id="ServerGPZSInfoMap" type="com.taomee.tms.mgr.entity.ServerGPZSInfo">
		<id column="server_id" property="serverId" jdbcType="INTEGER" />
		<result column="game_id" property="gameId" jdbcType="VARCHAR" />
		<result column="platform_id" property="platformId" jdbcType="INTEGER" />
		<result column="zone_id" property="zoneId" jdbcType="INTEGER" />
		<result column="s_id" property="sId" jdbcType="INTEGER" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="add_time" property="addTime" jdbcType="TIMESTAMP"
			javaType="java.sql.Timestamp" />
	</resultMap>
	
	<resultMap id="PlatformInfoMap" type="com.taomee.tms.mgr.entity.PlatformInfo">
		<result column="platform_id" property="platformId" jdbcType="INTEGER"/>
		<result column="p_name" property="platformName" jdbcType="VARCHAR"/>
	</resultMap>

	<resultMap id="ZSIdInfosMap" type="com.taomee.tms.mgr.entity.ZSIdInfos">
		<result column="zone_id" property="zoneId" jdbcType="INTEGER"/>
		<result column="s_id" property="sId" jdbcType="INTEGER" />
		<result column="zs_name" property="zoneServerName" jdbcType="VARCHAR"/>
	</resultMap> 
	
	<resultMap id="AllPlatformMap" type="com.taomee.tms.mgr.entity.ServerAllPlatform">
		<result column="server_id" property="gpzs_id" jdbcType="INTEGER"/>
		<result column="p_name" property="gpzs_name" jdbcType="VARCHAR" />
	</resultMap> 
	
	<!-- <resultMap id="AllPlatformMap" type="com.taomee.tms.mgr.entity.ServerAllPlatform">
		<result column="server_id" property="serverId" jdbcType="INTEGER"/>
		<result column="p_name" property="platformName" jdbcType="VARCHAR" />
	</resultMap>  -->
	
	<sql id="ServerGPZSInfoColumnList">
		server_id, game_id, platform_id, zone_id, s_id, status, add_time
	</sql>

	<sql id="PlatformInfoColumnList">
		platform_id, p_name
	</sql>
	
	<sql id="ZSInfoColumnList">
		zone_id, s_id, zs_name
	</sql>
	
	<select id="getPlatFormInfosByGameId"  resultMap="PlatformInfoMap"
		parameterType="java.lang.Integer">
		select
		<include refid="PlatformInfoColumnList" />
		from t_server_gpzs_info as gpzs inner join t_serverName_info as sn
		on gpzs.server_id = sn.server_id and gpzs.status = 0
		where
		gpzs.game_id = #{0} and  platform_id <![CDATA[ <> ]]> -1  
		and (zone_id = -1 or s_id = -1) 
	</select>
	
	
	
	<select id="getAllPlatByGameId"  resultMap="AllPlatformMap"
		parameterType="java.lang.Integer">
		select sn.server_id, sn.p_name
		from t_server_gpzs_info as gpzs inner join t_serverName_info as sn
		on gpzs.server_id = sn.server_id and gpzs.status = 0
		where
		gpzs.game_id = #{0}  and zone_id = -1 and s_id = -1
	</select>
	
	<select id="getZSInfosByGPId" resultMap="ZSIdInfosMap"
		parameterType="java.lang.Integer">
		select
		<include refid="ZSInfoColumnList" />
		from t_server_gpzs_info as gpzs inner join t_serverName_info as sn
		on gpzs.server_id = sn.server_id and gpzs.status = 0
		where 
		gpzs.game_id = #{0} and  platform_id = #{1} 
		and (zone_id  <![CDATA[ <> ]]> -1 or s_id  <![CDATA[ <> ]]> -1)
	</select>
	
	<select id="getServerIDByGPZS" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		select server_id
		from t_server_gpzs_info
		where game_id = #{0} and platform_id = #{1} and zone_id = #{2} and s_id = #{3} 
	</select>
	
	<select id="getAllServerGpzsInfos" resultMap="ServerGPZSInfoMap" >
		select 
		<include refid="ServerGPZSInfoColumnList" />
		from t_server_gpzs_info
	</select>
	
	<select id="getAllServerGpzsInfosByStatus" resultMap="ServerGPZSInfoMap" parameterType="java.lang.Integer">
		select 
		<include refid="ServerGPZSInfoColumnList" />
		from t_server_gpzs_info
		where status = #{0}
	</select>
	
	<!-- Integer insertServerGPZSInfo(Integer gameId, Integer platformId,
			Integer zoneId, Integer sId); -->
			
			
	<select id="getServerInfoByTopgameId" resultMap="ServerGPZSInfoMap"
		parameterType="java.lang.Integer">
		select
		<include refid="ServerGPZSInfoColumnList" />
		from t_server_gpzs_info
		where game_id =#{0} and platform_id = -1 and zone_id = -1 and s_id = -1 and status=0 
	</select>
	
	
	<update id="insertServerGPZSInfo">
		insert INTO t_server_gpzs_info
		(game_id, platform_id, zone_id, s_id)
		VALUES
		(#{0}, #{1}, #{2}, #{3})
		ON DUPLICATE KEY UPDATE
		status = 0
	</update>
			


	<update id="updateServerGPZSStatusByServerId">
		update
		t_server_gpzs_info
		set
		status = #{hide}
		where server_id = #{serverId,jdbcType=INTEGER}
	</update>
</mapper> 