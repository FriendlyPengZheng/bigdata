/*! taomee tongji javascript code by maverick 2015-02-04 */
!function(a){function b(){return++c}var c=0;a.widget("tm.tabs",{eventNamespace:"",active:null,options:{idPrefix:"J_uiTab",active:null,event:"click",activate:null,load:null,beforeLoad:null},_create:function(){this.options.active;this._generateTabs(),this.options.active=this._initActive(),this.active=this.options.active!==!1&&this.anchors.length?this.tabs.eq(this.options.active):a(),this._refresh(),this.active.length&&this.load(this.active)},_initActive:function(){var b=this.options.active,c=location.hash.substring(1);return null===b&&(c&&this.tabs.each(function(d){return a(this).attr("data-panel")==c?(b=d,!1):void 0}),null===b&&(b=this.tabs.index(this.tabs.filter(".tabs-active"))),(null===b||-1===b)&&(b=this.tabs.length?0:!1)),b!==!1&&(b=this.tabs.index(this.tabs.eq(b)),-1===b&&(b=0)),b===!1&&this.anchors.length&&(b=0),b},_getTabId:function(a){return a.attr("area-control")||this.options.idPrefix+b()},_generateTabs:function(){var b=this;this.tabList=this.element.find("ul").eq(0).addClass("tabs-list"),this.tabs=this.tabList.find(">li:has(a)").addClass("tabs-control"),this.anchors=this.tabs.map(function(){return a("a",this)[0]}),this.panels=a(),this.anchors.each(function(c,d){var e,f,g=a(d).closest("li");g.attr("data-for")?(f=g.attr("data-for"),e=a("#"+f)):(e=a(b.element.find(">div").get(c)),e.length||(e=a("<div>").appendTo(b.element)),f=b._getTabId(g)),e.attr("id",f),g.attr({"data-panel":f,title:g.text()}),e.hasClass("tabs-ajax")&&e.addClass("loading"),b.panels=b.panels.add(e)}),this.panels.addClass("tabs-panel clearfix"),this._afterGenerate()},_afterGenerate:function(){},_beforeSetupEvents:function(){},_refresh:function(){this._beforeSetupEvents(this.options.event),this._setupEvents(this.options.event),this.active.length&&(this.active.addClass("tabs-active"),this._getPanelForTab(this.active).show())},_setupEvents:function(b){var c={click:function(a){a.preventDefault()}};b&&a.each(b.split(" "),function(a,b){c[b]="_eventHandler"}),this._on(this.anchors,c)},_getPanelForTab:function(b){var c=a(b).attr("data-panel");return this.element.find("#"+c)},_eventHandler:function(b){var c=(this.options,a(b.currentTarget)),d=c.closest("li"),e=this._getPanelForTab(d),f=this.active.length?this._getPanelForTab(this.active):a(),g={oldTab:this.active,oldPanel:f,newTab:d,newPanel:e};d.hasClass("tabs-loading")||this.running||(this.active=d,e.length&&this.load(d,b),this._toggle(b,g))},_toggle:function(b,c){function d(){c.newTab.addClass("tabs-active"),g.length&&g.show(),e()}function e(){f.running=!1,f._trigger("activate",b,c)}var f=this,g=c.newPanel,h=c.oldPanel;this.running=!0,c.scrollTop=a(window).scrollTop(),h.length&&(c.oldTab.removeClass("tabs-active"),h.hide()),d()},load:function(b,c){var d=this._getPanelForTab(b),e={tab:b,panel:d},f=this;b.hasClass("tabs-ajax")&&!b.hasClass("tabs-loaded")&&(b.addClass("tabs-loading"),this._trigger("beforeLoad",c,e)&&window.setTimeout(function(){0!=f._trigger("load",c,e)&&(b.removeClass("tabs-loading"),b.addClass("tabs-loaded"),a(f.element).height()<e.panel.height()&&a(f.element).css("height",e.panel.height())),window.setTimeout(function(){b.removeClass("tabs-loading")},3e4)},100))},reload:function(){{var a=this.active;this._getPanelForTab(a)}a.hasClass("tabs-ajax")&&a.hasClass("tabs-loaded")&&!a.hasClass("tabs-loading")&&(a.removeClass("tabs-loaded"),this.load(a))},getActivePanel:function(){return this._getPanelForTab(this.active)},getPanels:function(){return this.panels},getActive:function(){return this.active},setReload:function(){this.tabs.not(".tabs-active").removeClass("tabs-loaded")},getTabs:function(){return this.tabs}}),a.widget("tm.tabsExtendMore",a.tm.tabs,{options:{minTabWidth:100},showTabs:null,moreTabThumb:null,moreList:null,moreTabs:null,moreTabsAnchors:null,maxWidth:null,spaceWidth:0,more:!0,_afterGenerate:function(){var b,c,d=this,e=0;return this.spaceWidth=this.maxWidth=this.tabList.width(),this.moreTabs=a(),this.showTabs=a(),a(this.tabs).each(function(){b=a(this).outerWidth(),e+=b+10+5+2,e>=d.maxWidth?d.moreTabs=d.moreTabs.add(a(this).attr("attr-width",b)):(d.spaceWidth-=b+10+5+2,d.showTabs=d.showTabs.add(a(this).attr("attr-width",b)))}),this.moreTabsAnchors=this.moreTabs.map(function(){return a("a",this)[0]}),this.moreTabsAnchors.length?(c=a(document.createElement("span")).text("more..."),this.moreList=a(document.createElement("ul")).addClass("tabs-more").hide().append(this.moreTabs),this.moreTabThumb=a(document.createElement("li")).addClass("tabs-more-thumb").append(c).append(this.moreList).appendTo(this.tabList),this.spaceWidth-=this.moreTabThumb.outerWidth()+5,void(this.spaceWidth>0?"":this.spaceWidth=0)):void(this.more=!1)},_beforeSetupEvents:function(){var a=this,b={click:"_moreTabsEventHandler"};this.more&&(this.moreTabThumb.on("click",function(){a.moreList.toggle()}),this._on(this.moreTabsAnchors,b))},_moreTabsEventHandler:function(b){var c=a(b.target).off(b),d=c.closest("li"),e=d.attr("attr-width");this.spaceWidth<e&&this._adjustTabWidth(e-this.spaceWidth),this.showTabs=this.showTabs.add(d),this.moreTabThumb.before(d)},_adjustTabWidth:function(b){var c=this;this.spaceWidth=0,this.showTabs.each(function(){b>0&&!a(this).hasClass("more-adjusted")&&(a(this).width(c.options.minTabWidth).addClass("more-adjusted"),b-=a(this).attr("attr-width")-c.options.minTabWidth)}),b>0?(this.showTabs.each(function(){b>0&&(c._on(a(this).width("auto").removeClass("more-adjusted").appendTo(c.moreList),{click:"_moreTabsEventHandler"}),b-=c.options.minTabWidth)}),this.spaceWidth-=b,this.showTabs=this.showTabs.filter(".more-adjusted")):this.spaceWidth-=b}})}(jQuery);