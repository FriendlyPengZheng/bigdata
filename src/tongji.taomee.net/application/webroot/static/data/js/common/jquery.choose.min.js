/*! taomee tongji javascript code by maverick 2015-02-04 */
var cnt=0;!function(){jQuery&&jQuery.choose||!function(a){a.choose={_type:{COMMONSELECT:1,PAGESELECT:2,RADIOSELECT:3,MULTISELECT:4},core:function(b){var c={type:1,mulRadio:1,data:[],page:2,search:!1,obj:a("body"),title:lang.t("请选择："),selected:[],dftNum:5,setNum:15,isRecord:!1,showBottom:!1,recordClass:"record",recordNum:1e3};switch(b=a.extend(c,b),b.type=parseInt(b.type,10),b.type){case 1:this._common_factory(b);break;case 2:this._page_factory(b);break;case 3:this._multi_factory(b);break;case 5:this._checkboxFactory(b)}},_common_factory:function(b){var c=this,d="common-choose";b.isRecord&&(d+=" "+b.recordClass);var e=c._basic_fac(b.title,d),f=e.find(".options-m"),g=e.find(".title-m"),h=g.find(".t-name"),i="";b.search&&this._common_search(f),i=this._common_option_fac(b.data,b.selected),f.append(a(i)),e.appendTo(b.obj),f.find(".opt-m").click(function(d){d.stopPropagation();{var g=a(this);h.attr("data-id"),g.attr("data-id")}if(e.hasClass(b.recordClass)){var i=a("body").data(b.recordClass);if(i=i?parseInt(i,10):0,e.hasClass("recorded")){var j=b.obj.closest(".sel-con").find(".sel-ul");j.length&&(i-=j.find(".act-li").length-1)}else{if(b.recordNum<=i)return void say(lang.t("指标选项个数不能超过{1}个~。~",b.recordNum));e.addClass("recorded"),i=i?parseInt(i,10)+1:1}a("body").data(b.recordClass,i)}c._handle_selected_event(h,g),b.showTitleFn&&b.showTitleFn(),"true"==g.attr("data-child")?c._get_child(g,b):g.closest(".select-m").parent().parent().find(".sel-ul").remove(),b.callback&&b.callback(b.obj,h),f.hide()}),f.find(".opt-m.selected-opt").click(),e.attr("tabindex","0").bind("keydown",function(b){var c=b.keyCode,d=a(this),e=d.find(".title-m").find(".t-name");switch(c){case 13:b.preventDefault();var f=d.find(".options-m").find(".selected-opt");0!=f.length&&f.click();break;case 38:b.preventDefault();var g=d.find(".selected-opt"),h=a();if(g.is(":visible")&&(h=g.prev().is(":visible")?g.prev():g.prevAll(".opt-m:visible").first()),0==h.length)return;var i=h.length>0?h.position().top:0,j=h.parent();if(h&&i<h.height()){var k=j.scrollTop();k+=i-g.position().top,j.scrollTop(k)}h&&h.hasClass("opt-m")&&a.choose._handle_selected_event(e,h);break;case 40:b.preventDefault();var g=d.find(".selected-opt"),h=a();if(h=g.is(":visible")?g.next().is(":visible")?g.next():g.nextAll(".opt-m:visible").first():d.find(".opt-m:visible").first(),0==h.length)return;var i=h.length>0?h.position().top:0,j=h.parent();if(h&&i>j.height()-h.height()){var k=j.scrollTop();k+=i-g.position().top,j.scrollTop(k)}h&&h.hasClass("opt-m")&&a.choose._handle_selected_event(e,h)}})},_get_child:function(b,c){var d=b.data("children");if(d)a.choose._show_child(b,d,c);else if(b.data("data")){var e=b.data("data");b.data("children",e),a.choose._show_child(b,e,c)}else{var f=function(d){b.data("children",d),a.choose._show_child(b,d,c)};c.getData&&c.getData(b.attr("data-cid"),f)}},_show_child:function(b,c,d){switch(parseInt(d.mulRadio,10)){case 1:a.choose._mul_child(b,c,d);break;case 2:a.choose._radio_child(b,c,d);break;case 3:a.choose._click_child(b.closest(".selected-m"),c,d)}},_click_child:function(b,c,d){var e=b.parent(),f=a(document.createElement("ul")).addClass("sel-ul"),g="";e.find(".sel-ul").remove(),a.each(c,function(){g+='<li class="sel-li ',this.selected&&(g+="act-li"),g+='" ',a.each(this.attr,function(a,b){g+="data-"+a+'="'+b+'"'}),g+='><span class="child-m" >'+this.title+"</span></li>"}),e.append(f.html(g)),f.find(".sel-li").click(function(c){c.stopPropagation(),d.clickChildFn&&d.clickChildFn(a(this),b)})},_mul_child:function(b,c,d){var e=a("body"),f=a(document.createElement("ul")).addClass("sel-ul"),g="",h=b.closest(".selected-m"),i=h.closest(".sel-p").parent();i.find(".sel-ul").remove(),a.each(c,function(){g+='<li class="sel-li ',this.selected&&(g+="act-li"),g+='" ',a.each(this.attr,function(a,b){g+="data-"+a+'="'+b+'"'}),g+='><span class="child-m" >'+this.title+"</span></li>"}),f.html(g);var j=1;if(d.isRecord&&h.hasClass(d.recordClass)){var k=e.data(d.recordClass);k=k?parseInt(k,10):0;var l=d.recordNum-(k-1),j=l-d.dftNum>0?d.dftNum:l}if(0==f.find(".act-li").length&&f.find(".sel-li:lt("+j+")").addClass("act-li"),d.isRecord&&h.hasClass(d.recordClass)){var m=f.find(".act-li").length;m=m?m:1,k+=m-1,e.data(d.recordClass,k)}var n=f.find(".act-li"),o=n.length,p=f.find(".sel-li").not(".sel-tools"),q=p.length;q>d.setNum&&(o>d.setNum?n.filter(":gt("+(d.setNum-1)+")").addClass("hide-li"):p.not(".act-li").filter(":gt("+(d.setNum-o-1)+")").addClass("hide-li"),f.append(a(document.createElement("li")).addClass("sel-li sel-tools").html('<a class="more" href="javascript:void(0);">more</a>'))),f.append(a(document.createElement("li")).addClass("sel-li sel-tools").html('<a class="sel-all" href="javascript:void(0);">all</a>')),f.appendTo(i),a.choose._more_event(f,d),a.choose._all_event(f,d),d.showTitleFn&&d.showTitleFn(),f.find(".sel-li").click(function(b){b.stopPropagation();var c=a(this),g=f.find(".act-li").length;if(d.isRecord&&h.hasClass(d.recordClass)){var i=e.data(d.recordClass);if(i=i?parseInt(i,10):0,c.hasClass("act-li"))g>1&&(i-=1);else{if(d.recordNum-i<=0)return void say(lang.t("指标选项不能超过{1}个~.~",d.recordNum));i+=1}e.data(d.recordClass,i)}c.hasClass("act-li")?g>1&&c.removeClass("act-li"):c.addClass("act-li"),d.showTitleFn&&d.showTitleFn(),d.childFn&&d.childFn(a(this))})},_multi_factory:function(b){var c=a(document.createElement("ul")).addClass("sel-ul"),d="";a.each(b.data,function(){d+='<li class="sel-li ',(this.selected||a.tools._in_array(b.sel,this.attr.id))&&(d+="act-li"),d+='" ',a.each(this.attr,function(a,b){d+="data-"+a+'="'+b+'"'}),d+='><span class="child-m" >'+this.title+"</span></li>"}),c.html(d);var e=b.dftNum;0==c.find(".act-li").length&&c.find(".sel-li:lt("+e+")").addClass("act-li");var f=c.find(".act-li"),g=f.length,h=c.find(".sel-li").not(".sel-tools"),i=h.length;i>b.setNum&&(g>b.setNum?f.filter(":gt("+(b.setNum-1)+")").addClass("hide-li"):h.not(".act-li").filter(":gt("+(b.setNum-g-1)+")").addClass("hide-li"),c.append(a(document.createElement("li")).addClass("sel-li sel-tools").html('<a class="more" href="javascript:void(0);">more</a>'))),c.append(a(document.createElement("li")).addClass("sel-li sel-tools").html('<a class="sel-all" href="javascript:void(0);">all</a>')),c.appendTo(b.obj),a.choose._more_event(c,b),a.choose._all_event(c,b),c.find(".sel-li").click(function(d){d.stopPropagation();var e=a(this),f=c.find(".act-li").length;e.hasClass("act-li")?f>1&&e.removeClass("act-li"):e.addClass("act-li"),b.callback&&b.callback(e)})},_radio_child:function(b,c,d){var e=a(document.createElement("ul")).addClass("sel-ul"),f="",g=b.closest(".selected-m"),h=g.closest(".sel-p").parent();h.find(".sel-ul").remove(),a.each(c,function(){f+='<li class="sel-li ',this.selected&&(f+="act-li"),f+='" ',a.each(this.attr,function(a,b){f+="data-"+a+'="'+b+'"'}),f+='><span class="child-m" >'+this.title+"</span></li>"}),e.html(f);var i=e.find(".act-li"),j=i.length,k=e.find(".sel-li").not(".sel-tools"),l=k.length;l>d.setNum&&(j>d.setNum?i.filter(":gt("+(d.setNum-1)+")").addClass("hide-li"):k.not(".act-li").filter(":gt("+(d.setNum-j-1)+")").addClass("hide-li"),e.append(a(document.createElement("li")).addClass("sel-li sel-tools").html('<a class="more" href="javascript:void(0);">more</a>'))),e.appendTo(h),d.showTitleFn&&d.showTitleFn(),e.find(".sel-li").click(function(b){b.stopPropagation();var c=a(this);c.hasClass("act-li")||(e.find(".act-li").removeClass("act-li"),c.addClass("act-li")),d.showTitleFn&&d.showTitleFn(),d.childFn&&d.childFn(a(this))}),a.choose._more_event(e,d)},_more_event:function(b,c){b.find(".more").toggle(function(c){c.stopPropagation(),b.find(".hide-li").removeClass("hide-li"),a(this).text("pack")},function(d){d.stopPropagation(),b.find(".sel-li").not(".act-li:lt("+c.setNum+")").not(".sel-tools").addClass("hide-li"),a(this).text("more")})},_all_event:function(b,c){var d=a("body");b.find(".sel-all").toggle(function(e){e.stopPropagation();var f=a(this),g=b.find(".sel-li").not(".sel-tools");if(c.isRecord&&c.obj.find(".selected-m").hasClass(c.recordClass)){var h=d.data(c.recordClass),i=b.find(".act-li").length,j=g.length-i;h=h?parseInt(h,10):0;var k=c.recordNum-h;if(0>=k)return void say(lang.t("指标选项不能超过{1}个~.~",c.recordNum));k>=j?(g.not(".act-li").addClass("act-li"),h+=j):(g.not(".act-li").filter(":lt("+k+")").addClass("act-li"),h+=k),d.data(c.recordClass,h)}else g.not(".act-li").addClass("act-li");f.addClass("seled-all")},function(e){e.stopPropagation();var f=a(this);if(c.isRecord&&c.obj.find(".selected-m").hasClass(c.recordClass)){var g=d.data(c.recordClass),h=b.find(".act-li").length;g=g?parseInt(g,10):0,g-=h-1,d.data(c.recordClass,g)}b.find(".act-li:gt(0)").removeClass("act-li"),f.removeClass("seled-all")})},_handle_selected_event:function(a,b){var c=b.find(".opt-v").text();b.parent().find(".selected-opt").removeClass("selected-opt"),b.addClass("selected-opt"),a.attr({"data-id":b.attr("data-id"),"data-child":b.attr("data-child"),"data-stat":b.attr("data-stat"),"data-common":b.attr("data-common"),title:c}).text(c).parent().parent().addClass("selected-m")},_common_option_fac:function(b,c){var d="<ul>";return a.each(b,function(){d+='<li class="opt-m ',(this.selected||a.tools._in_array(c,this.attr.id))&&(d+="selected-opt"),d+='" ',a.each(this.attr,function(a,b){d+="data-"+a+'="'+b+'" '}),d+='><span class="opt-v" title="'+this.title+'">'+this.title+"</span>",this.attr.child&&(d+='<span class="dir"></span>'),d+="</li>"}),d+="</ul>"},_common_search:function(b){var c=a(document.createElement("div")).addClass("sel-search").html('<span class="search-con"><input type="text" class="srh-txt" /><i class="search-tag">&nbsp;</i></span>');b.css({"border-top":"1px solid #bbb"}).append(c),c.find(".search-tag").click(function(a){a.stopPropagation()}),c.find(".srh-txt").click(function(a){a.stopPropagation()}).keyup(function(){var c=a(this).val(),d=new RegExp(c);b.find("li span.opt-v").each(function(){var b=a(this),e=b.text();if(d.test(e)){var f=e.replace(d,'<font style="color: #261CDC; font-weight: bold; ">'+c+"</font>");b.html(f),b.parent().removeClass("hide-li")}else b.parent().addClass("hide-li")})}).keydown(function(a){a.keyCode})},_checkboxFactory:function(b){var c=this,d="page-choose",e=c._basic_fac(b.title,d,b.showBottom),f=e.find(".options-m"),g=e.find(".title-m"),h=g.find(".t-name"),i='</span> <a class="sel-all" href="javascript:void(0);">'+lang.t("全选")+"</a>",j='<a class="sel-reverse" href="javascript:void(0);">'+lang.t("反选")+"</a>";f.append(c._checkboxOptionFac(b.data,b.selected)),b.search&&c._page_search(f),e.appendTo(b.obj),a(j).insertAfter(a(".search-con")),a(i).insertAfter(a(".search-con")),f.click(function(a){a.stopPropagation()}),f.find('.subchk-li input[name="chk-choose"]').click(function(){var b=(a(this),""),c="",d=f.find('input[name="chk-choose"]:checked');d.length?e.addClass("selected-m"):e.removeClass("selected-m"),a(d).each(function(d){var e=a(this).closest(".subchk-li").find(".sub-li-a").text();c+=0==d?e:1==d?lang.t("、")+e:2==d?"...":"",b+=a(this).closest(".subchk-li").attr("data-id")+","}),h.attr({"data-id":b.slice(0,-1)}).text(c?c:lang.t("请选择："))}),f.find(".sel-all").click(function(){f.find("li").each(function(){a(this).find("input").not(":checked").attr({checked:!0})});var b="",c="",d=f.find('input[name="chk-choose"]:checked');e.addClass("selected-m"),a(d).each(function(d){var e=a(this).closest(".subchk-li").find(".sub-li-a").text();c+=0==d?e:1==d?lang.t("、")+e:2==d?"...":"",b+=a(this).closest(".subchk-li").attr("data-id")+","}),h.attr({"data-id":b.slice(0,-1)}).text(c)}),f.find(".sel-reverse").click(function(){f.find("li").find("input").each(function(){a(this).attr("checked"==a(this).attr("checked")?{checked:!1}:{checked:!0})});var b="",c="",d=f.find('input[name="chk-choose"]:checked');d.length?e.addClass("selected-m"):e.removeClass("selected-m"),a(d).each(function(d){var e=a(this).closest(".subchk-li").find(".sub-li-a").text();c+=0==d?e:1==d?lang.t("、")+e:2==d?"...":"",b+=a(this).closest(".subchk-li").attr("data-id")+","}),h.attr({"data-id":b.slice(0,-1)}).text(c?c:lang.t("请选择："))})},_page_factory:function(b){var c=this,d="page-choose";b.isRecord&&(d+=" "+b.recordClass);var e=c._basic_fac(b.title,d,b.showBottom),f=e.find(".options-m"),g=e.find(".title-m"),h=g.find(".t-name");2==b.page&&f.append(c._page_option_fac(b.data,b.selected)),b.search&&c._page_search(f),f.click(function(a){a.stopPropagation()}),f.find(".sub-cat-li").click(function(d){d.stopPropagation();var g=a(this),i=g.find(".sub-li-a");if(e.hasClass(b.recordClass)){var j=a("body").data(b.recordClass);if(j=j?parseInt(j,10):0,e.hasClass("recorded")){var k=b.obj.closest(".sel-con").find(".sel-ul");k.length&&(j-=k.find(".act-li").length-1)}else{if(b.recordNum<=j)return void say(lang.t("指标选项个数不能超过{1}个~。~",b.recordNum));e.addClass("recorded"),j=j?parseInt(j,10)+1:1}a("body").data(b.recordClass,j)}f.find(".sub-cat-li .sub-li-a.cur").removeClass("cur"),e.addClass("selected-m"),i.addClass("cur"),h.attr({"data-id":g.attr("data-id"),"data-child":g.attr("data-child"),"data-stat":g.attr("data-stat"),"data-common":g.attr("data-common")}).text(i.text()),b.callback&&b.callback(b.obj,h),"true"==g.attr("data-child")?c._get_child(g,b):g.closest(".select-m").parent().parent().find(".sel-ul").remove(),b.showTitleFn&&b.showTitleFn(),f.hide()}),f.find(".sub-cat-li .dir").click(function(a){a.stopPropagation()}),e.appendTo(b.obj);var i=f.find(".sub-li-a.cur");i.length&&i.parent().click()},_page_search:function(b){var c=a(document.createElement("div")).addClass("subview-search").html('<span class="search-con"><input type="text" class="srh-txt"><i class="search-tag">&nbsp;</i></span>');c.click(function(a){a.stopPropagation()}).prependTo(b).find(".srh-txt").keyup(function(){var c=a(this).val(),d=new RegExp(c);b.find(".sub-li-a").each(function(){var b=a(this),e=b.text();if(d.test(e)){var f=e.replace(d,'<font style="color: #58a601; font-weight: bold; ">'+c+"</font>");b.html(f),b.parent().removeClass("hide-li")}else b.parent().addClass("hide-li")})})},_checkboxOptionFac:function(b){var c=a(document.createElement("ul")).addClass("subchk-con clearfix");return subviewLis=a(),a.each(b,function(){var b=a(document.createElement("li")).addClass("subchk-li"),c={};this.attr&&a.each(this.attr,function(a,b){c["data-"+a]=b}),b.attr(c).append(a('<label><input type="checkbox" class="mr2" name="chk-choose"><span class="sub-li-a">'+this.title+"</span></label>")),subviewLis=subviewLis.add(b)}),c.append(subviewLis),c},_page_option_fac:function(b,c){var d=a(document.createElement("ul")).addClass("subview-con clearfix");return subviewLis=a(),a.each(b,function(){var b=a(document.createElement("li")).addClass("subview-li"),d={};if(this.attr&&a.each(this.attr,function(a,b){d["data-"+a]=b}),b.attr(d).append(a(document.createElement("h4")).addClass("subview-hd").text(this.title)),this.children&&0!=this.children.length){var e=a(document.createElement("ul")).addClass("subview-cat"),f=a();a.each(this.children,function(){var b=a(document.createElement("li")).addClass("sub-cat-li"),d={},e=a(document.createElement("a")).addClass("sub-li-a"+(c&&a.tools._in_array(c,this.attr.id)?" cur":"")).text(this.title);this.attr&&a.each(this.attr,function(a,b){d["data-"+a]=b,"id"==a&&(d.title=b)}),b.attr(d).append(e),this.attr.child&&b.append(a(document.createElement("span")).addClass("dir")),this.data&&b.data("data",this.data),f=f.add(b)}),e.append(f).appendTo(b)}subviewLis=subviewLis.add(b)}),d.append(subviewLis),d},_basic_fac:function(b,c,d){var e={display:"none"};d?e.bottom="26px":e.top="26px";{var f=a(document.createElement("div")).addClass("select-m "+c),g=a(document.createElement("div")).addClass("title-m"),h=a(document.createElement("div")).addClass("options-m").css(e);a(document.createElement("span")).addClass("t-name").text(b).appendTo(g)}return g.add(h).appendTo(f),g.click(function(b){b.stopPropagation(),h.is(":visible")?h.hide():(a("body").find(".select-m .options-m").hide(),h.find(".subview-search .search-con .srh-txt").val("").keyup(),h.show())}),a("body").click(function(){h.is(":visible")&&h.hide()}),f}},a.tools={_in_array:function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1},_get_left:function(b,c){c=c?c:a(window);var d=a(window).width(),e=b.width()?b.width():130;return d-e>0?(d-e)/2:0},_overlayer:function(b){cnt++;var c={text:lang.t("加载中...")};a.extend(c,b);var d=a("#J_layer"),e=a("#J_notice"),f=a("body");0==d.length?d=a(document.createElement("div")).addClass("layer").attr("id","J_layer").appendTo(f):d.show(),0==e.length?(e=a(document.createElement("div")).addClass("notice").attr("id","J_notice").css({left:a.tools._get_left(e)+"px",top:0}).appendTo(f),e.text(c.text)):(e.text(c.text),e.css({left:a.tools._get_left(e)+"px",top:0}).show())},_hidelayer:function(b){if(cnt--,0==cnt){var b=b?b:"",c=a("#J_notice");c.text(b),a("#J_layer").add(c).hide()}},_set_center:function(b){var c=a(window).width(),d=a(window).height(),e=parseInt(b.css("width"),10),f=parseInt(b.css("height"),10),g=0,h=a("body").scrollTop();c-e>0&&(g=(c-e)/2),h+=d-f>0?(d-f)/2:40,b.css({left:g+"px",top:h+"px"})},show:function(b){var c=a("#J_popOver");c.length?c.show():(c=a(document.createElement("div")).addClass("overlayer").attr({id:"J_popOver"}),c.appendTo(a("body")).show()),a.tools._set_center(b),b.show()},hide:function(b){var c=a("#J_popOver");c.length&&c.remove(),b.hide()}},a.popup={_type:{CONFIRMPOP:1},core:function(b){var c={type:1,obj:a("body"),title:lang.t("弹出框"),content:"",okButton:lang.t("保存"),cancelButton:lang.t("取消"),close:function(){},ok:function(){},cancel:function(){},callback:function(){}};switch(b=a.extend(c,b),type=parseInt(b.type,10),type){case this._type.CONFIRMPOP:this._confirm_factory(b)}},_confirm_factory:function(b){var c=a(document.createElement("div")).addClass("popup-wrapper").attr({id:b.id}).css({display:"none"}),d='<div class="popup-t-wrap"><div class="popup-title">'+b.title+'</div><div class="popup-tools"><a href="javascript:void(0);" class="t-close">&nbsp;</a></div></div><div class="popup-c-wrap">'+b.content+'</div><div class="popup-b-wrap"><a href="javascript:void(0)" class="btn-s-dft mr10 save"><span>'+b.okButton+'</span></a><a href="javascript:void(0)" class="btn-s-dft cancel" ><span>'+b.cancelButton+"</span></a><div>";c.html(d).appendTo(b.obj),c.dragIt({holder:".popup-title",limit:!1}),b.callback&&b.callback(c),c.find(".t-close").click(function(d){d.stopPropagation(),a.tools.hide(c),b.close&&b.close(c)}),c.find(".cancel").click(function(d){d.stopPropagation(),a.tools.hide(c),b.cancel&&b.cancel(c)}),c.find(".save").click(function(a){a.stopPropagation(),b.ok&&b.ok(c)})}}}(jQuery)}();